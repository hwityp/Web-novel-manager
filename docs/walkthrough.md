# WNAP v1.3.7 Hotfix: Normalization Order

## 1. "외전 + 에필로그" 추출 수정 (완료)
- **원인 분석**: 
    - 메인 GUI는 기존 `rename_normalize.py`가 아닌 `TitleAnchorExtractor` (in `core/title_anchor_extractor.py`)를 사용합니다.
    - `TitleAnchorExtractor`가 여러 외전 마커(예: "Epilogue AND Side Story")를 처리할 때 반복문이 아닌 단일 체크만 수행하여 실패했습니다.
    - 또한 "및", "포함" 같은 연결어를 제거하는 로직이 없어 "에필 및 외전" 파싱을 방해했습니다.
- **해결**: 
    - **전역 노이즈 제거**: `_parse_residual` 단계에서 "및", "포함", "comp", "only" 등을 사전 제거하는 단계를 추가했습니다.
    - **루프 추출**: 단일 체크 방식을 `while` 루프로 변경하여 모든 마커(예: "에필", "외전")를 캡처하도록 수정했습니다.
- **검증**: `check_title_extractor.py`를 통해 "회귀했더니 입대 전날 1-529 完 에필 및 외전 포함.txt"가 **"Side Story: '에필, 외전'"**으로 올바르게 파싱됨을 확인했습니다.


---


## 1. 윈도우 경로 처리 수정 (검증됨)
- **문제**: `shutil.copy2` 사용 시 후행 공백이 있는 파일명(예: `"file .txt"`)에서 `FileNotFoundError` 발생 (윈도우 API가 공백 자동 제거).
- **해결**: `PipelineOrchestrator._move_file`에 견고한 경로 처리 로직 구현.
- **방법**: 윈도우 절대 경로 앞에 `\\?\` 접두사를 자동으로 추가(예: `\\?\C:\Path\To\file .txt`)하여 API가 정규화 없이 원본 경로를 그대로 사용하도록 강제.

---


## 1. 정규화 로직 개선 (검증됨)
- **목표**: "및", "포함" 같은 노이즈가 있어도 "외전", "에필로그"를 보존.
- **테스트 케이스**: `회귀했더니 입대 전날 1-529 完 에필 및 외전 포함.txt`
- **결과 로그**:
  ```
  Testing: 회귀했더니 입대 전날 1-529 完 에필 및 외전 포함.txt
  Result: [현판] 회귀했더니 입대 전날 1-529 (완) + 외전,  에필.txt
  SUCCESS: Both '에필' and '외전' preserved.
  ```
- **해결**: 추출 전 regex 전처리를 통해 `및`과 `포함` 제거.

## 2. 장르 보존 최적화
- **목표**: `[Genre]` 태그가 이미 존재하면 API 검색 건너뛰기.
- **구현**: `GenreClassifierAdapter`가 `[선협]` 같은 태그를 확인하고 `GENRE_WHITELIST`를 사용해 매핑.

## 3. CSV 경로 수정
- **목표**: `mapping_*.csv` 파일을 프로그램 루트에 저장.
- **구현**: `pipeline_orchestrator.py`에서 `get_base_path()` 사용.
- **검증**: `Base Path Check: C:\Users\hwity\Cursor_Work\WebNovelManager`

---
# WNAP v1.3.2 업데이트

GUI 레이아웃이 최적화되고 고급 제어를 위한 CLI 옵션이 통합되었습니다.

## 새로운 기능 (v1.3.2)

### 1. CLI / 터미널 통합
GUI를 터미널에서 실행할 때 `log-level`을 제어할 수 있습니다.
- **명령어**: `python main_gui.py --log-level DEBUG`
- **이점**: 터미널에서 상세한 디버그 로그를 실시간으로 확인하며 트러블슈팅 가능.

### 2. GUI 레이아웃 리팩토링
- **테이블 확장**: 상단의 '실행 옵션' 프레임을 제거하고, 확보된 공간만큼 **결과 테이블을 확장**했습니다.
- **가독성 강화**:
    - **폰트 크기**: 테이블 폰트 크기를 **1.2배 확대**하여 가독성 강화.
    - **컬럼 극대화**: '정규화 파일명' 컬럼이 남은 공간을 모두 차지하여 긴 제목도 잘림 없이 표시됩니다.
- **버튼 스타일링**:
    - **[▶️ 실행 (Rename)]**: **녹색(Green)** + Bold 텍스트로 변경하여 "최종 실행"임을 명확히 강조.
    - **[⚡ 일괄 처리]**: **청색(Blue)** 계열로 변경하여 실행 버튼과 시각적 구분.

## 새로운 기능 (v1.3.3)

### 3. 일괄 처리 실시간 업데이트
일괄 처리 시 답답했던 UI 멈춤 현상을 해결했습니다.
- **실시간 테이블 갱신**: 장르 추론이 끝날 때마다 테이블의 장르/신뢰도/판단근거가 즉시 채워집니다.
- **상태별 컬러링**:
    - **성공(Renamed)**: 짙은 녹색 배경 (#1E3A2A)으로 성공 여부 직관적 확인.
    - **건너뜀(Skipped)**: 회색 배경 (#404040)으로 처리 제외 항목 구분.
- **안전 팝업**: '일괄 처리' 중이라도 실제 파일 변경 직전에 "총 N개 파일을 변경하시겠습니까?" 팝업을 띄워 실수를 방지합니다.

## 새로운 기능 (v1.3.4)

### 4. 이원화된 로깅 시스템
목적에 따라 로그 파일을 이원화했습니다.
- **`wnap.log`**: 핵심 요약용 (항상 INFO 레벨 고정). 이전 기록과 간단한 실행 이력을 확인하기 좋습니다.
- **`wnap_YYYYMMDD.log`**: 상세 분석용. `--log-level DEBUG` 등으로 설정한 상세 로그가 여기에 모두 기록됩니다.

## 사용 가이드 (업데이트됨)
1.  **[1. 폴더 정리]**: 파일 스캔.
2.  **[2. 파일명 정규화]**: 제목 파싱.
3.  **[3. 장르 추론]**: AI 검색 수행 (테이블 갱신).
4.  **[▶️ 실행 (Rename)]**: 녹색 버튼 클릭 -> 최종 파일 이름 변경.

### 고급 사용 (Advanced)
- 디버깅이 필요한 경우 터미널에서 `--log-level DEBUG` 옵션을 사용하세요.
